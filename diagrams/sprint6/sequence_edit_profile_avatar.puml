@startuml sequence_annuler_absence

hide footbox


actor "Utilisateur" as user
participant "editeProfilePage" as editeProfilePage << View >>
participant "Camera" as camera << system >>
participant "settingsStore" as settingsStore << ViewModel >>
participant "profile" as profile << Model >>
participant "eliseRestApi" as eliseRestApi << service >>

ref over user,editeProfilePage,eliseRestApi,profile,settingsStore : Authentification

activate user
user -> editeProfilePage : takePhoto()
activate editeProfilePage
editeProfilePage -> camera : getPhoto()
activate camera
camera --> editeProfilePage 
deactivate editeProfilePage
camera -> user : affiche la camera
user -> camera : prend une photo
camera --> user : retourne la photo
user -> camera : confirme la photo
camera --> editeProfilePage : photo
deactivate camera
activate editeProfilePage
editeProfilePage -> settingsStore : updateAvatar()
activate settingsStore
activate settingsStore
settingsStore -> eliseRestApi : :POST elise-avatar/update 
activate eliseRestApi
eliseRestApi --> settingsStore : updateResponse
settingsStore --> editeProfilePage 
deactivate eliseRestApi
alt avatar mis à jour
settingsStore -> settingsStore : setProfileAvatar()
settingsStore -> settingsStore : getProfile()
settingsStore -> profile : setProfile()
activate profile
profile -> settingsStore : getProfileResponse
deactivate profile
settingsStore -> editeProfilePage : updateAvatarResponse
editeProfilePage -> user : affiche le message "Avatar mis à jour"
else
settingsStore -> editeProfilePage : updateAvatarResponse
deactivate settingsStore
editeProfilePage -> user : affiche le message "Erreur lors de la mise à jour de l'avatar"
deactivate editeProfilePage
end
deactivate user
 